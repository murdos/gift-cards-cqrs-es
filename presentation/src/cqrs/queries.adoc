== Afficher la liste des cartes cadeaux

Tri√©e, pagin√©e, filtr√©e, ... ü§î
[.notes]
--
Les √©v√©nements c'est super pour avoir l'historique complet et savoir pr√©cis√©ment ce qui s'est pass√©, mais comment je fais pour afficher une liste de toutes mes cartes cadeaux avec quelques infos, comme le montant restant et la boutique de la carte ?
Relire tous les √©v√®nements de toutes les cartes cadeaux √† chaque fois para√Æt compliqu√©...
Et si en plus on doit pagine, filtrer sur des crit√®res, comme par exemple le montant restant, trier selon d'autres crit√®res, ...
il nous faut les projeter.
--

=== Read/Query model!

image::../../assets/jamy.jpg[]
image::https://spatie.be/docs/laravel-event-sourcing/v7/images/transform-03.svg[]

[.notes]
--
TODO: refaire le sch√©ma
On va utiliser un mod√®le de lecture, √©galement appel√© "read model ou ""query model", d√©di√© √† notre use case.
--

[%notitle]
=== Illustration : 1st event
image::https://codeopinion.com/wp-content/uploads/2021/02/s2-1024x466.png[]

[.notes]
--
TODO: refaire le sch√©ma
GiftCardCreated
-> GiftCardCurrentState
--

[%notitle]
=== Illustration : 2nd event
image::https://codeopinion.com/wp-content/uploads/2021/02/s2-1024x466.png[]

[.notes]
--
TODO: refaire le sch√©ma
GiftCardCreated
+ PaidAmount
-> GiftCardCurrentState
--

[%notitle]
=== Illustration : 3rd event
image::https://codeopinion.com/wp-content/uploads/2021/02/s2-1024x466.png[]

[.notes]
--
TODO: refaire le sch√©ma
GiftCardCreated
+ PaidAmount
+ PaidAmount
-> GiftCardCurrentState
--

[.notes]
--
On utilise un mod√®le de lecture d√©di√©
Egalement appel√© "read model ou ""query model"
--

=== Code
üîç

=== Query Model

[source, java, highlight]
----
include::../../../src/main/java/io/craft/giftcard/giftcard/domain/projections/GiftCardCurrentState.java[lines='15..20']
----

[.notes]
--
- C√¥te code, le mod√®le de lecture s'appelle GiftCardCurrentState
- Comment est-il calculer ? (event handler)
--

=== Event handler

[source, java, highlight]
----
include::../../../src/main/java/io/craft/giftcard/giftcard/domain/projections/GiftCardCurrentStateUpdater.java[lines='9..10,22..28']
----

[.notes]
--
- L'event handler va √™tre appel√© √† chaque fois qu'un √©v√©nement est √©mis, et va pouvoir mettre √† jour le mod√®le de lecture
--

=== GiftCardCurrentState

[source, java, highlight]
----
include::../../../src/main/java/io/craft/giftcard/giftcard/domain/projections/GiftCardCurrentState.java[lines='22..38']
----

[.notes]
--
- L'event handler va √™tre appel√© √† chaque fois qu'un √©v√©nement est √©mis, et va pouvoir mettre √† jour le mod√®le de lecture
--
